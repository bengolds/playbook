<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="function-row.html">
<link rel="import" href="mathObjects/math-objects-import.html">

<dom-module id="main-app">
  <template>
    <style>
      #card {
        display: block;
        max-width:1280px;
        margin:0px auto;
      }
    </style>
    <paper-card id="card">
      <template is='dom-repeat' id='repeater' items='{{scope.functions}}'>
        <function-row 
          function-definition='{{item}}'
          scope='{{scope}}'
          graph-parameters='{{graphParameters}}'
        ></function-row>
      </template>
    </paper-card>
    <button on-click='addRow'>+</button>

  </template>

  <script>
    Polymer({
      is: 'main-app',
      properties: {
        scope: {
          type: Object,
          value: function() {return new Scope();},
        },
        graphParameters: {
          type: Object,
          value: function() {
            return {xRange: [-5, 5], yRange: [-5, 5]};
          }
        },
        startNamesAt: {
          type: String,
          value: 'f'
        }
      },

      listeners: {
        // 'remove-row': 'removeRow'
      },

      attached: function () {
        this.addRow();
      },

      addRow: function () {
        let nextFunc = new FunctionDefinition(this.getNextName());
        this.push('scope.functions', nextFunc);
      },

      removeRow: function (_, name) {
        let index = this.scope.functions.findIndex((func) => {
          return func.name === name;
        });

        if (index == -1) {
          throw Error('Can\'t delete ' + name + ' because it doesn\'t exist');
        }

        this.splice('scope.functions', index, 1);
      },

      getNextName: function() {
        let isNameInRow = (name) => {
          return this.scope.functions.some((func) => {
            return func.name === name;
          });
        };
        let nextName = this.startNamesAt;
        while (isNameInRow(nextName)) {
          nextName = String.fromCharCode(nextName.charCodeAt(0)+1);
        }
        return nextName;
      },

    });
 </script>
</dom-module>