<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="function-row.html">
<link rel="import" href="mathObjects/math-objects-import.html">

<dom-module id="main-app">
  <template>
    <style>
      #card {
        display: block;
        max-width:1280px;
        margin:0px auto;
      }
      #addButton {
        margin-left: auto;
        margin-right: auto;
        margin-top: 16px;
        --paper-fab-background: #FFFFFF;
        --paper-fab-keyboard-focus-background: #4285F4;
      }
    </style>
      <template is='dom-repeat' id='repeater' items='{{scope.functions}}'>
        <function-row 
          function-definition='{{item}}'
          scope='{{scope}}'
          graph-parameters='{{graphParameters}}'
        ></function-row>
      </template>
      <paper-fab id='addButton' icon="add" 
        on-click='addRow' 
        on-focus='buttonFocused'
        on-blur='buttonBlurred'></paper-fab>

  </template>

  <script>
    Polymer({
      is: 'main-app',
      properties: {
        scope: {
          type: Object,
          value: function() {return new Scope();},
        },
        graphParameters: {
          type: Object,
          value: function() {
            return {xRange: [-5, 5], yRange: [-5, 5]};
          }
        },
        startNamesAt: {
          type: String,
          value: 'f'
        }
      },

      listeners: {
        // 'remove-row': 'removeRow'
      },

      attached: function () {
        this.addRow();
        this.buttonBlurred();
      },

      addRow: function () {
        let nextFunc = new FunctionDefinition(this.getNextName());
        this.push('scope.functions', nextFunc);
      },

      removeRow: function (_, name) {
        let index = this.scope.functions.findIndex((func) => {
          return func.name === name;
        });

        if (index == -1) {
          throw Error('Can\'t delete ' + name + ' because it doesn\'t exist');
        }

        this.splice('scope.functions', index, 1);
      },

      getNextName: function() {
        let isNameInRow = (name) => {
          return this.scope.functions.some((func) => {
            return func.name === name;
          });
        };
        let nextName = this.startNamesAt;
        while (isNameInRow(nextName)) {
          nextName = String.fromCharCode(nextName.charCodeAt(0)+1);
        }
        return nextName;
      },

      buttonFocused: function() {
        //NO WAY TO DO THIS FROM CSS I GUESS
        this.$.addButton.$.icon.style.color = '#FFFFFF';
      },

      buttonBlurred: function() {
        //NO WAY TO DO THIS FROM CSS I GUESS
        this.$.addButton.$.icon.style.color = '#757575';
      }

    });
 </script>
</dom-module>