<link rel="import" href="mathquill-element.html">
<link rel="import" href="var-action-bar.html">

<dom-module id="function-signature">
  <template>
    <style>
      :host {
        display: block;
      }
      #quill {
        font-size: 200%;
      }
      .hidden {
        display:none;
      }
    </style>

  <mathquill-element id="quill"
    on-element-mouseover='onElementMouseOver'>
  </mathquill-element>
  <var-action-bar id="actionbar" class="hidden" functor='{{functor}}'></var-action-bar>

  </template>
  <script>
    Polymer({
      is: 'function-signature',
      properties: {
        functor: {
          type: Object,
          observer: '_functorChanged',
          notify: true
        },
        symbol: {
          type: String,
          value: 'ÆŸ'
        }
      },

      attached: function () {
        this._functorChanged();
      },
      
      _functorChanged: function () {
        let latex = this.symbol + '\\left(';
        if (this.functor) {
          let sorted = this.functor.symbols.slice().sort();
          latex += sorted.join(',');
        }
        latex += '\\right)=';
        this.$.quill.latex(latex);
      },

      onElementMouseOver: function (e, details) {
        var mqCmdId = 'mathquill-command-id';
        var mqBlockId = 'mathquill-block-id';
        if (details.target.tagName == 'VAR' &&
            details.target.textContent != this.symbol) {
          this.showHoverBar(details.target);
          $(this).on('mouseout', this.hideHoverBar);
        }
      },

      showHoverBar: function (target) {
        let actionbar = this.$.actionbar;
        actionbar.classList.remove('hidden');
        var topY = target.offsetTop+target.offsetHeight;
        var middleX = target.offsetLeft + target.offsetWidth/2 - actionbar.offsetWidth/2;
        actionbar.style.left = middleX + 'px';
        actionbar.style.bottom = topY + 'px';
        actionbar.variable = target.textContent;
      },

      hideHoverBar: function() {
        this.$.actionbar.classList.add('hidden');
        $(this).off('mouseout', this.hideHoverBar);
      }

    });
  </script>
</dom-module>