<link rel="import" href="mathquill/mathquill-import.html">
<dom-module id="mathquill-input">
	<link rel="import" type="css" href="mathquill/mathquill.css"/>
	<template>
		<style>
			:host {
				display: block;
			}
			.hovered {
				background-color: red;
			}
		</style>
		<span id="quill"></span>
	</template>
	<script>
		Polymer({
			is: 'mathquill-input',

			ready: function() {
				this.scopeSubtree(this.$.quill, true);
				var MQ = MathQuill.getInterface(2);
				MQ.MathField(this.$.quill, {
					handlers: {
						edit: this.edit.bind(this),
						mouseover: this.onElementMouseOver.bind(this),
						mouseout: this.onElementMouseOut.bind(this)
					}
				});
			},
			edit: function(mathField) {
				this.fire('edit', {mathField: mathField});
			},
			onElementMouseOver: function(mathField, target) {
				this.fire('element-mouseover', {mathField: mathField, target: target});
				// var mqCmdId = 'mathquill-command-id';
				// var mqBlockId = 'mathquill-block-id';
				// function getClosestApplicationNode(semanticNode) {
				// 	if (semanticNode instanceof ApplicationNode) {
				// 		return semanticNode;
				// 	} else if (semanticNode == null) {
				// 		return null;
				// 	}
				// 	return getClosestApplicationNode(semanticNode.parent);
				// }
				// var jqTarget = $(target);
				// var id = -1;
				// if (jqTarget.attr(mqBlockId)) {
				// 	id = jqTarget.attr(mqBlockId);
				// } else {
				// 	id = jqTarget.attr(mqCmdId);
				// }
				// var semanticTree = mathField.semanticTree();
				// var semanticNode = semanticTree.findDisplayNode(id);
				// var applicationNode = getClosestApplicationNode(semanticNode);
				// this.hoveredDisplayNodes = applicationNode.getDisplayNodes();
				// for (var i = 0; i < this.hoveredDisplayNodes.length; i++) {
				// 	this.hoveredDisplayNodes[i].jQ.addClass('hovered');
				// }
				// console.log(applicationNode.toString());
			},
			onElementMouseOut: function(mathField, target) {
				this.fire('element-mouseout', {mathField: mathField, target: target});
				// for (var i = 0; i < this.hoveredDisplayNodes.length; i++) {
				// 	this.hoveredDisplayNodes[i].jQ.removeClass('hovered');
				// }
			}
		});
	</script>
</dom-module>