<link rel="import" href="mathquill/mathquill-import.html">
<dom-module id="function-input">
	<link rel="import" type="css" href="mathquill/mathquill.css"/>
	<template>
		<style>
			:host {
				flex-grow: 1;
			}
			.hovered {
				background-color: red;
			}
			#quill {
				font-size:200%;
			}
		</style>
		<mathquill-element id="quill" editable="true" 
   on-element-mouseover='onElementMouseOver'
   >
 </mathquill-element>
</template>
<script>
  Polymer({
    is: 'function-input',

    ready: function() {
      this.scopeSubtree(this.$.quill, true);
    },

    onElementMouseOver: function(e, details) {
      var mqCmdId = 'mathquill-command-id';
      var mqBlockId = 'mathquill-block-id';
      var getClosestApplicationNode = (semanticNode) => {
        if (semanticNode instanceof ApplicationNode) {
          return semanticNode;
        } else if (semanticNode == null) {
          return null;
        }
        return getClosestApplicationNode(semanticNode.parent);
      };
      var jqTarget = $(details.target);
      var id = -1;
      if (jqTarget.attr(mqBlockId)) {
        id = jqTarget.attr(mqBlockId);
      } else if (jqTarget.attr(mqCmdId)) {
        id = jqTarget.attr(mqCmdId);
      } else {
        return;
      }
      var semanticTree = details.mathField.semanticTree();
      var semanticNode = semanticTree.findDisplayNode(id);
      var applicationNode = getClosestApplicationNode(semanticNode);
      this.hoveredDisplayNodes = applicationNode.getDisplayNodes();
      for (var i = 0; i < this.hoveredDisplayNodes.length; i++) {
        this.hoveredDisplayNodes[i].jQ.addClass('hovered');
      }
    },
    onElementMouseOut: function(e, details) {
      if (this.hoveredDisplayNodes != null) {
        for (var i = 0; i < this.hoveredDisplayNodes.length; i++) {
          this.hoveredDisplayNodes[i].jQ.removeClass('hovered');
        }
      }
    }
  });
</script>
</dom-module>